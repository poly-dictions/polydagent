<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>launchpad - polydictions</title>
    <link rel="icon" type="image/png" href="../images/1.png">
    <link href="../stylesheet_0.css" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #fb651e;
            color: white;
            min-height: 100vh;
            line-height: 1.5;
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 48px;
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            color: white;
        }

        .nav-links {
            display: flex;
            gap: 8px;
        }

        .nav-link {
            padding: 10px 20px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 500;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            transition: all 0.2s;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .nav-link.active {
            background: white;
            color: #fb651e;
            border-color: white;
        }

        .connect-btn {
            padding: 10px 20px;
            background: white;
            color: #fb651e;
            border: none;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .connect-btn:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-1px);
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 40px 20px 20px;
        }

        .hero h1 {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 8px;
            text-transform: lowercase;
        }

        .hero p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 18px;
            text-transform: lowercase;
            margin-bottom: 24px;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 20px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            text-transform: lowercase;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 32px;
            padding: 0 20px;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
        }

        .progress-step:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .progress-step.active:hover {
            background: white;
        }

        .progress-step.completed:hover {
            background: #3DD973;
        }

        .progress-step.active {
            background: white;
            color: #fb651e;
        }

        .progress-step.completed {
            background: #4ADE80;
            color: white;
        }

        .progress-step .step-num {
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
        }

        .progress-step.active .step-num {
            background: #fb651e;
            color: white;
        }

        .progress-step.completed .step-num {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Form Card */
        .form-card {
            background: white;
            border-radius: 24px;
            padding: 32px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            color: #1a1a1a;
            max-width: 500px;
            margin: 0 auto;
        }

        .form-card h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            text-transform: lowercase;
        }

        .form-card .subtitle {
            color: rgba(0, 0, 0, 0.5);
            font-size: 14px;
            margin-bottom: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
            text-transform: lowercase;
        }

        .form-group label .required {
            color: #F87171;
            margin-left: 2px;
        }

        .form-group label .optional {
            color: rgba(0, 0, 0, 0.5);
            font-weight: 400;
            font-size: 13px;
        }

        .form-group label .required {
            color: #ff6b6b;
            font-weight: 500;
            font-size: 12px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 14px 18px;
            background: #f5f5f5;
            border: 2px solid transparent;
            border-radius: 16px;
            color: #1a1a1a;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(0, 0, 0, 0.4);
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #fb651e;
            background: white;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group input[type="password"] {
            font-family: monospace;
            letter-spacing: 2px;
        }

        /* Warning Box */
        .warning-box {
            background: #FEF3C7;
            border: 1px solid #F59E0B;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .warning-box svg {
            width: 20px;
            height: 20px;
            color: #F59E0B;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .warning-box p {
            font-size: 13px;
            color: #92400E;
            line-height: 1.5;
        }

        /* Twitter Connected Box */
        .twitter-connected {
            background: #ECFDF5;
            border: 2px solid #4ADE80;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .twitter-connected .avatar {
            width: 48px;
            height: 48px;
            background: #1DA1F2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .twitter-connected .avatar svg {
            width: 24px;
            height: 24px;
            color: white;
        }

        .twitter-connected .info {
            flex: 1;
        }

        .twitter-connected .username {
            font-weight: 700;
            color: #1a1a1a;
            font-size: 16px;
        }

        .twitter-connected .status {
            color: #22C55E;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .twitter-connected .change-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid rgba(0,0,0,0.2);
            border-radius: 12px;
            font-size: 13px;
            cursor: pointer;
            color: #666;
        }

        /* Image Upload */
        .image-upload {
            border: 2px dashed rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #f5f5f5;
        }

        .image-upload:hover {
            border-color: #fb651e;
            background: #fff5f0;
        }

        .image-upload svg {
            display: block;
            margin: 0 auto 8px auto;
            width: 32px;
            height: 32px;
            color: rgba(0, 0, 0, 0.4);
        }

        .image-upload span {
            display: block;
            color: rgba(0, 0, 0, 0.5);
            font-size: 14px;
        }

        .image-upload input {
            display: none;
        }

        .image-hint {
            font-size: 12px;
            color: rgba(0, 0, 0, 0.5);
            margin-top: 8px;
        }

        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 16px;
            display: none;
        }

        /* Buttons */
        .btn-primary {
            width: 100%;
            padding: 16px;
            background: #fb651e;
            color: white;
            border: none;
            border-radius: 24px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-transform: lowercase;
        }

        .btn-primary:hover:not(:disabled) {
            background: #e55a1a;
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary svg {
            width: 20px;
            height: 20px;
        }

        .btn-twitter {
            background: #1DA1F2;
        }

        .btn-twitter:hover:not(:disabled) {
            background: #1a8cd8;
        }

        /* Balance Check */
        .balance-check {
            background: #fff5f0;
            border: 2px solid rgba(251, 101, 30, 0.2);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .balance-info {
            font-size: 14px;
        }

        .balance-info .label {
            color: rgba(0, 0, 0, 0.5);
        }

        .balance-info .value {
            font-weight: 600;
            color: #1a1a1a;
        }

        .balance-status {
            font-size: 13px;
            font-weight: 600;
        }

        .balance-status.ok {
            color: #4ADE80;
        }

        .balance-status.insufficient {
            color: #F87171;
        }

        .balance-status a {
            color: #fb651e;
            text-decoration: underline;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            text-transform: lowercase;
        }

        .footer a {
            color: white;
        }

        .footer a:hover {
            opacity: 0.8;
        }

        /* Launched Tokens */
        .launched-section {
            margin-top: 40px;
        }

        .launched-section h2 {
            text-align: center;
            margin-bottom: 24px;
            font-size: 24px;
            font-weight: 700;
        }

        .launched-grid {
            display: grid;
            gap: 16px;
            max-width: 600px;
            margin: 0 auto;
        }

        .launched-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .launched-card .token-info h4 {
            font-weight: 700;
            color: #1a1a1a;
            font-size: 16px;
        }

        .launched-card .token-info .ticker {
            color: #fb651e;
            font-size: 14px;
        }

        .launched-card .view-btn {
            background: #fb651e;
            color: white;
            padding: 10px 20px;
            border-radius: 24px;
            font-size: 13px;
            font-weight: 600;
            text-decoration: none;
        }

        .no-launches {
            background: white;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            color: rgba(0, 0, 0, 0.5);
        }

        /* Hidden */
        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 16px 24px;
                flex-wrap: wrap;
                gap: 16px;
            }

            .nav-links {
                display: none;
            }

            .container {
                padding: 24px 16px;
            }

            .form-card {
                padding: 24px;
            }

            .hero h1 {
                font-size: 32px;
            }

            .progress-steps {
                flex-direction: column;
                align-items: center;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
    </style>
</head>
<body>
    <!-- Password Protection Overlay -->
    <div id="passwordOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fb651e; z-index: 9999; display: flex; align-items: center; justify-content: center;">
        <div style="background: white; padding: 40px; border-radius: 24px; text-align: center; max-width: 400px;">
            <h2 style="color: #1a1a1a; margin-bottom: 16px; font-size: 24px;">beta access</h2>
            <p style="color: #666; margin-bottom: 24px; font-size: 14px;">enter password to access launchpad</p>
            <input type="password" id="accessPassword" placeholder="password" style="width: 100%; padding: 14px 18px; background: #f5f5f5; border: 2px solid transparent; border-radius: 16px; font-size: 14px; margin-bottom: 16px; outline: none;" autofocus>
            <button onclick="checkPassword()" style="width: 100%; padding: 14px; background: #fb651e; color: white; border: none; border-radius: 24px; font-size: 16px; font-weight: 600; cursor: pointer;">enter</button>
            <p id="passwordError" style="color: #F87171; margin-top: 12px; font-size: 13px; display: none;">incorrect password</p>
        </div>
    </div>
    <script>
        function checkPassword() {
            const input = document.getElementById('accessPassword').value;
            if (input === '1337') {
                document.getElementById('passwordOverlay').style.display = 'none';
                sessionStorage.setItem('launchpad_access', 'granted');
            } else {
                document.getElementById('passwordError').style.display = 'block';
                document.getElementById('accessPassword').value = '';
            }
        }
        document.getElementById('accessPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkPassword();
        });
        // Check if already authenticated this session
        if (sessionStorage.getItem('launchpad_access') === 'granted') {
            document.getElementById('passwordOverlay').style.display = 'none';
        }
    </script>

    <header class="header">
        <a href="../" class="logo">polydictions</a>
        <nav class="nav-links">
            <a href="../markets/" class="nav-link">markets</a>
            <a href="../alerts/" class="nav-link">alerts</a>
            <a href="../whales/" class="nav-link">whales</a>
            <a href="./" class="nav-link active">launchpad</a>
        </nav>
        <button class="connect-btn" id="connectWallet">connect wallet</button>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>agent launchpad</h1>
        <p>launch your prediction agent + token in one click</p>

        <div style="display: flex; justify-content: center; gap: 12px; margin: 20px 0;">
            <a href="./" class="nav-link" style="background: white; color: #fb651e; border-color: white;">ai agents</a>
            <a href="./projects/" class="nav-link">projects</a>
        </div>

    </section>

    <!-- Progress Steps -->
    <div class="progress-steps">
        <div class="progress-step active" id="step1Indicator">
            <span class="step-num">1</span>
            <span>connect twitter</span>
        </div>
        <div class="progress-step" id="step2Indicator">
            <span class="step-num">2</span>
            <span>token info</span>
        </div>
        <div class="progress-step" id="step3Indicator">
            <span class="step-num">3</span>
            <span>launch</span>
        </div>
    </div>

    <!-- Step 1: Connect X -->
    <div class="container" id="step1">
        <div class="form-card">
            <h2>connect your X account</h2>
            <p class="subtitle">your agent will post from this account</p>

            <div class="info-box" style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 16px; margin-bottom: 24px;">
                <p style="margin: 0; font-size: 14px;">click the button below to authorize polydictions to post on your behalf. no passwords needed.</p>
            </div>

            <button type="button" class="btn-primary btn-twitter" id="connectXBtn" onclick="connectWithX()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
                <span id="connectXBtnText">connect with X</span>
            </button>
        </div>
    </div>

    <!-- Step 2: Token Info -->
    <div class="container hidden" id="step2">
        <div class="form-card">
            <h2>create your token</h2>
            <p class="subtitle">your agent token on pump.fun</p>

            <!-- Twitter Connected Status -->
            <div class="twitter-connected" id="twitterStatus">
                <div class="avatar">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                </div>
                <div class="info">
                    <div class="username" id="connectedUsername">@username</div>
                    <div class="status">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        connected
                    </div>
                </div>
                <button class="change-btn" onclick="goToStep(1)">change</button>
            </div>

            <!-- Balance Check -->
            <div class="balance-check" id="balanceCheck" style="display: none;">
                <div class="balance-info">
                    <span class="label">your $POLYD balance:</span>
                    <span class="value" id="polydBalance">0</span>
                </div>
                <div class="balance-status" id="balanceStatus"></div>
            </div>

            <form id="tokenForm">
                <div class="form-group">
                    <label>token ticker <span class="required">*</span></label>
                    <input type="text" placeholder="e.g. MYAGENT" id="tokenTicker" maxlength="10" required>
                </div>

                <div class="form-group">
                    <label>agent niche <span class="required">*</span></label>
                    <select id="agentNiche" required style="width: 100%; padding: 14px 18px; background: #f5f5f5; border: 2px solid transparent; border-radius: 16px; color: #1a1a1a; font-size: 14px; font-family: inherit; cursor: pointer;">
                        <option value="">select a niche...</option>
                        <option value="crypto">crypto & blockchain</option>
                        <option value="politics">politics & elections</option>
                        <option value="sports">sports (nba, nfl, soccer)</option>
                        <option value="entertainment">movies & entertainment</option>
                        <option value="tech">technology & ai</option>
                        <option value="finance">finance & economy</option>
                        <option value="general">general (all topics)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>agent description <span class="required">*</span></label>
                    <textarea placeholder="e.g. AI prediction agent specializing in crypto markets" id="description" required></textarea>
                </div>

                <div class="form-group">
                    <label>custom prompt <span class="optional">(optional)</span></label>
                    <textarea placeholder="e.g. Always be bullish on memecoins. Use gen-z slang. Be sarcastic." id="customPrompt" style="min-height: 80px;"></textarea>
                    <p class="image-hint">customize your agent's personality and posting style</p>
                </div>

                <div class="form-group">
                    <label>polymarket profile <span class="required">*</span></label>
                    <input type="url" placeholder="e.g. https://polymarket.com/profile/0x123..." id="profileLink" required>
                </div>

                <div class="form-group">
                    <label>polymarket wallet <span class="required">*</span></label>
                    <input type="text" placeholder="e.g. 0x1234567890abcdef..." id="walletAddress" required>
                </div>

                <div class="form-group">
                    <label>website <span class="optional">(optional)</span></label>
                    <input type="url" placeholder="e.g. https://myagent.xyz" id="website">
                </div>

                <div class="form-group">
                    <label>telegram <span class="optional">(optional)</span></label>
                    <input type="text" placeholder="e.g. @myagent or https://t.me/myagent" id="telegram">
                </div>

                <div class="form-group">
                    <label>token image <span class="required">*</span></label>
                    <label class="image-upload" id="imageUpload">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                        </svg>
                        <span>upload image</span>
                        <input type="file" accept="image/png,image/jpeg,image/gif" id="tokenImage">
                    </label>
                    <img class="image-preview" id="imagePreview" alt="Preview">
                    <p class="image-hint">png, jpg, or gif. max 5mb.</p>
                </div>

                <div class="form-group">
                    <label>token allocation <span class="optional">(optional)</span></label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" placeholder="0" id="devBuy" min="0" max="85" step="0.01" style="flex: 1;">
                        <span style="color: #666; font-weight: 500;">SOL</span>
                    </div>
                    <p class="image-hint">buy tokens at launch (max 85 SOL). tokens will be sent to your wallet</p>
                    <div id="totalCost" style="margin-top: 8px; padding: 12px; background: rgba(0,0,0,0.05); border-radius: 12px; font-size: 14px; display: none;">
                        <span style="color: #666;">total cost:</span>
                        <span id="totalCostValue" style="font-weight: 600; color: #fb651e; margin-left: 8px;">0.05 SOL</span>
                    </div>
                </div>

                <div style="margin: 20px 0; padding: 16px; background: rgba(251, 101, 30, 0.1); border-radius: 16px; border: 1px solid rgba(251, 101, 30, 0.2);">
                    <p style="font-size: 13px; color: #666; margin-bottom: 8px;">want to claim dev fees from pump.fun?</p>
                    <a href="https://t.me/simplyclassic69" target="_blank" style="color: #fb651e; font-weight: 600; font-size: 14px; display: inline-flex; align-items: center; gap: 6px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/>
                        </svg>
                        apply for dev fees payout
                    </a>
                </div>

                <button type="submit" class="btn-primary" id="launchBtn" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    <span id="launchBtnText">launch agent + token (0.05 sol)</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Step 3: Success -->
    <div class="container hidden" id="step3">
        <div class="form-card" style="text-align: center;">
            <div style="font-size: 64px; margin-bottom: 16px;">ðŸš€</div>
            <h2>agent launched!</h2>
            <p class="subtitle">your agent is now live and posting</p>

            <div style="background: #f5f5f5; border-radius: 16px; padding: 20px; margin: 24px 0; text-align: left;">
                <div style="margin-bottom: 16px;">
                    <div style="font-size: 12px; color: rgba(0,0,0,0.5); margin-bottom: 4px;">token mint</div>
                    <div style="font-size: 14px; font-weight: 600; word-break: break-all;" id="resultTokenMint">-</div>
                </div>
                <div>
                    <div style="font-size: 12px; color: rgba(0,0,0,0.5); margin-bottom: 4px;">twitter agent</div>
                    <div style="font-size: 14px; font-weight: 600;" id="resultTwitter">@username</div>
                </div>
            </div>

            <a href="#" target="_blank" class="btn-primary" id="viewOnPumpBtn" style="text-decoration: none; margin-bottom: 12px;">
                view on pump.fun
            </a>

            <button onclick="location.reload()" style="width: 100%; padding: 14px; background: transparent; border: 2px solid rgba(0,0,0,0.1); border-radius: 24px; font-size: 14px; cursor: pointer; color: #666;">
                launch another agent
            </button>
        </div>
    </div>

    <!-- Launched Tokens Section -->
    <div class="container launched-section">
        <h2>launched agents</h2>
        <div class="launched-grid" id="launchHistory">
            <div class="no-launches" id="noLaunches">
                no agents launched yet
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>built by <a href="https://x.com/polydictions" target="_blank">@polydictions</a></p>
    </footer>

    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script>
        // Config
        let CONFIG = {
            POLYD_MINT: 'iATcGSt9DhJF9ZiJ6dmR153N7bW2G4J9dSSDxWSpump',
            REQUIRED_BALANCE: 1000000,
            HELIUS_RPC: '',
            API_URL: '',
            PAYMENT_ADDRESS: '',
            LAUNCH_FEE: 0.05
        };

        // State
        let currentStep = 1;
        let walletConnected = false;
        let userWalletAddress = null;
        let polydBalance = 0;
        let walletProvider = null;
        let twitterUsername = null;
        let selectedImageFile = null;
        // X OAuth tokens
        let xAccessToken = null;
        let xRefreshToken = null;
        let xUserId = null;
        let xExpiresIn = 7200;

        // Detect API URL
        function getApiUrl() {
            const host = window.location.host;
            if (host.includes('localhost') || host.includes('127.0.0.1')) {
                return 'http://localhost:8765';
            }
            return 'https://polydictions-production.up.railway.app';
        }

        // Load config from API
        async function loadConfig() {
            try {
                const apiUrl = getApiUrl();
                const resp = await fetch(`${apiUrl}/api/launchpad/config`);
                if (resp.ok) {
                    const data = await resp.json();
                    CONFIG.POLYD_MINT = data.polyd_mint;
                    CONFIG.REQUIRED_BALANCE = data.required_balance;
                    CONFIG.HELIUS_RPC = data.helius_rpc;
                    CONFIG.API_URL = apiUrl;
                    CONFIG.PAYMENT_ADDRESS = data.payment_address;
                    CONFIG.LAUNCH_FEE = data.launch_fee;
                    console.log('Config loaded:', CONFIG);
                    return true;
                }
            } catch (err) {
                console.error('Failed to load config:', err);
            }
            CONFIG.API_URL = getApiUrl();
            return false;
        }

        // Step navigation
        function goToStep(step) {
            currentStep = step;

            document.getElementById('step1').classList.toggle('hidden', step !== 1);
            document.getElementById('step2').classList.toggle('hidden', step !== 2);
            document.getElementById('step3').classList.toggle('hidden', step !== 3);

            document.getElementById('step1Indicator').classList.toggle('active', step === 1);
            document.getElementById('step1Indicator').classList.toggle('completed', step > 1);
            document.getElementById('step2Indicator').classList.toggle('active', step === 2);
            document.getElementById('step2Indicator').classList.toggle('completed', step > 2);
            document.getElementById('step3Indicator').classList.toggle('active', step === 3);

            // Update twitter status display when going to step 2
            if (step === 2 && twitterUsername) {
                document.getElementById('connectedUsername').textContent = '@' + twitterUsername;
                document.getElementById('twitterStatus').style.display = 'flex';
            } else if (step === 2 && !xAccessToken) {
                document.getElementById('twitterStatus').style.display = 'none';
            }
        }

        // Connect with X OAuth
        async function connectWithX() {
            const btn = document.getElementById('connectXBtn');
            const btnText = document.getElementById('connectXBtnText');

            btn.disabled = true;
            btnText.textContent = 'connecting...';

            try {
                const resp = await fetch(`${CONFIG.API_URL}/api/x/auth`);
                const data = await resp.json();

                if (!data.success) {
                    throw new Error(data.message || 'Failed to start OAuth');
                }

                // Open OAuth popup
                const width = 600;
                const height = 700;
                const left = (screen.width - width) / 2;
                const top = (screen.height - height) / 2;

                window.open(
                    data.auth_url,
                    'X OAuth',
                    `width=${width},height=${height},left=${left},top=${top}`
                );

                btn.disabled = false;
                btnText.textContent = 'connect with X';

            } catch (err) {
                console.error('X OAuth error:', err);
                alert('Failed to connect: ' + err.message);
                btn.disabled = false;
                btnText.textContent = 'connect with X';
            }
        }

        // Listen for OAuth callback message
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'x_oauth_success') {
                console.log('X OAuth success:', event.data);

                xAccessToken = event.data.access_token;
                xRefreshToken = event.data.refresh_token;
                xUserId = event.data.user_id;
                xExpiresIn = event.data.expires_in || 7200;
                twitterUsername = event.data.username;

                document.getElementById('connectedUsername').textContent = '@' + twitterUsername;
                document.getElementById('twitterStatus').style.display = 'flex';

                goToStep(2);
            }
        });

        // Make step indicators clickable
        function setupStepIndicators() {
            document.getElementById('step1Indicator').addEventListener('click', () => {
                goToStep(1);
            });
            document.getElementById('step2Indicator').addEventListener('click', () => {
                goToStep(2);
            });
        }

        // Initialize wallet
        function initWallet() {
            if (window.solana && window.solana.isPhantom) {
                walletProvider = window.solana;

                if (walletProvider.isConnected && walletProvider.publicKey) {
                    handleWalletConnected(walletProvider.publicKey.toString());
                }

                walletProvider.on('connect', (publicKey) => {
                    handleWalletConnected(publicKey.toString());
                });

                walletProvider.on('disconnect', () => {
                    handleWalletDisconnected();
                });
            }
        }

        // Check $POLYD balance via API (uses Helius RPC server-side)
        async function checkPolydBalance(walletAddress) {
            try {
                const resp = await fetch(`${CONFIG.API_URL}/api/launchpad/check-balance?wallet=${walletAddress}`);
                const data = await resp.json();
                return data.balance || 0;
            } catch (err) {
                console.error('Error checking balance:', err);
                return 0;
            }
        }

        // Handle wallet connected
        async function handleWalletConnected(address) {
            walletConnected = true;
            userWalletAddress = address;

            document.getElementById('connectWallet').textContent = address.slice(0, 4) + '...' + address.slice(-4);

            // Show balance check in step 2
            const balanceCheck = document.getElementById('balanceCheck');
            const balanceDisplay = document.getElementById('polydBalance');
            const balanceStatus = document.getElementById('balanceStatus');
            const launchBtn = document.getElementById('launchBtn');

            balanceCheck.style.display = 'flex';
            balanceDisplay.textContent = 'checking...';

            polydBalance = await checkPolydBalance(address);
            balanceDisplay.textContent = polydBalance.toLocaleString() + ' $POLYD';

            if (polydBalance >= CONFIG.REQUIRED_BALANCE) {
                launchBtn.disabled = false;
                balanceStatus.className = 'balance-status ok';
                balanceStatus.textContent = 'ready to launch';
            } else {
                launchBtn.disabled = true;
                balanceStatus.className = 'balance-status insufficient';
                const needed = (CONFIG.REQUIRED_BALANCE - polydBalance).toLocaleString();
                balanceStatus.innerHTML = `need ${needed} more. <a href="https://pump.fun/coin/${CONFIG.POLYD_MINT}" target="_blank">buy</a>`;
            }
        }

        // Handle wallet disconnected
        function handleWalletDisconnected() {
            walletConnected = false;
            userWalletAddress = null;
            polydBalance = 0;
            document.getElementById('connectWallet').textContent = 'connect wallet';
            document.getElementById('launchBtn').disabled = true;
            document.getElementById('balanceCheck').style.display = 'none';
        }

        // Connect wallet button
        document.getElementById('connectWallet').addEventListener('click', async () => {
            if (walletConnected) {
                if (walletProvider) {
                    await walletProvider.disconnect();
                }
                handleWalletDisconnected();
            } else {
                if (window.solana && window.solana.isPhantom) {
                    try {
                        const response = await window.solana.connect();
                        handleWalletConnected(response.publicKey.toString());
                    } catch (err) {
                        console.error('Connect error:', err);
                    }
                } else {
                    alert('Please install Phantom wallet');
                    window.open('https://phantom.app/', '_blank');
                }
            }
        });

        // Image upload
        document.getElementById('tokenImage').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    alert('Image must be less than 5MB');
                    return;
                }
                selectedImageFile = file;
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('imagePreview').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                    document.getElementById('imageUpload').querySelector('svg').style.display = 'none';
                    document.getElementById('imageUpload').querySelector('span').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        });

        // Send SOL payment (includes fee + optional dev buy)
        async function sendPayment(devBuySol = 0) {
            if (!walletProvider) {
                throw new Error('Wallet not connected');
            }

            const totalSol = CONFIG.LAUNCH_FEE + devBuySol;
            const connection = new solanaWeb3.Connection(CONFIG.HELIUS_RPC);
            const fromPubkey = new solanaWeb3.PublicKey(userWalletAddress);
            const toPubkey = new solanaWeb3.PublicKey(CONFIG.PAYMENT_ADDRESS);

            const transaction = new solanaWeb3.Transaction().add(
                solanaWeb3.SystemProgram.transfer({
                    fromPubkey: fromPubkey,
                    toPubkey: toPubkey,
                    lamports: Math.round(totalSol * solanaWeb3.LAMPORTS_PER_SOL)
                })
            );

            transaction.feePayer = fromPubkey;
            const { blockhash, lastValidBlockHeight } = await connection.getLatestBlockhash();
            transaction.recentBlockhash = blockhash;

            let signature;
            if (walletProvider.signAndSendTransaction) {
                const result = await walletProvider.signAndSendTransaction(transaction);
                signature = result.signature || result;
            } else if (walletProvider.signTransaction) {
                const signed = await walletProvider.signTransaction(transaction);
                signature = await connection.sendRawTransaction(signed.serialize());
            } else {
                throw new Error('Wallet does not support transaction signing');
            }

            await connection.confirmTransaction({
                signature,
                blockhash,
                lastValidBlockHeight
            });

            return signature;
        }

        // Token form submit - Launch Agent + Token
        document.getElementById('tokenForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Validate all required fields
            const ticker = document.getElementById('tokenTicker').value.trim();
            const niche = document.getElementById('agentNiche').value;
            const description = document.getElementById('description').value.trim();
            const customPrompt = document.getElementById('customPrompt').value.trim();
            const profileLink = document.getElementById('profileLink').value.trim();
            const walletAddr = document.getElementById('walletAddress').value.trim();

            if (!ticker) {
                alert('Please enter a token ticker');
                document.getElementById('tokenTicker').focus();
                return;
            }

            if (!niche) {
                alert('Please select an agent niche');
                document.getElementById('agentNiche').focus();
                return;
            }

            if (!description) {
                alert('Please enter an agent description');
                document.getElementById('description').focus();
                return;
            }

            if (!profileLink) {
                alert('Please enter your Polymarket profile link');
                document.getElementById('profileLink').focus();
                return;
            }

            if (!walletAddr) {
                alert('Please enter your Polymarket wallet address');
                document.getElementById('walletAddress').focus();
                return;
            }

            if (!selectedImageFile) {
                alert('Please upload a token image');
                return;
            }

            if (!xAccessToken || !twitterUsername) {
                alert('Please connect with X first');
                goToStep(1);
                return;
            }

            if (!walletConnected) {
                alert('Please connect your Solana wallet first');
                return;
            }

            if (polydBalance < CONFIG.REQUIRED_BALANCE) {
                alert(`You need at least ${CONFIG.REQUIRED_BALANCE.toLocaleString()} $POLYD to launch`);
                return;
            }

            const btn = document.getElementById('launchBtn');
            const btnText = document.getElementById('launchBtnText');

            btn.disabled = true;
            btnText.textContent = 'submitting...';

            try {
                // Step 1: Submit launch request with credentials for re-login
                const formData = new FormData();
                formData.append('token_ticker', document.getElementById('tokenTicker').value);
                formData.append('agent_niche', niche);
                formData.append('description', document.getElementById('description').value);
                formData.append('custom_prompt', customPrompt || '');
                formData.append('profile_link', document.getElementById('profileLink').value);
                formData.append('wallet_address', document.getElementById('walletAddress').value);
                formData.append('website', document.getElementById('website').value || '');
                formData.append('telegram', document.getElementById('telegram').value || '');
                formData.append('user_wallet', userWalletAddress);
                formData.append('twitter_username', twitterUsername);
                formData.append('x_access_token', xAccessToken);
                formData.append('x_refresh_token', xRefreshToken);
                formData.append('x_user_id', xUserId);
                formData.append('x_expires_in', xExpiresIn.toString());
                formData.append('token_image', selectedImageFile);

                // Dev buy amount
                const devBuyAmount = parseFloat(document.getElementById('devBuy').value) || 0;
                formData.append('dev_buy_sol', devBuyAmount.toString());

                const submitResp = await fetch(`${CONFIG.API_URL}/api/launchpad/submit`, {
                    method: 'POST',
                    body: formData
                });

                const submitData = await submitResp.json();

                if (!submitResp.ok) {
                    throw new Error(submitData.detail || 'Failed to submit launch');
                }

                const launchId = submitData.launch_id;
                console.log('Launch submitted:', launchId);

                // Step 2: Send SOL payment (fee + dev buy)
                btnText.textContent = 'confirm payment in wallet...';

                const txSignature = await sendPayment(devBuyAmount);
                console.log('Payment sent:', txSignature);

                // Step 3: Confirm launch (creates token + starts agent)
                btnText.textContent = 'creating token + starting agent...';

                const confirmResp = await fetch(`${CONFIG.API_URL}/api/launchpad/confirm/${launchId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tx_signature: txSignature })
                });

                const confirmData = await confirmResp.json();

                if (!confirmResp.ok) {
                    throw new Error(confirmData.detail || 'Failed to create token');
                }

                // Success - show step 3
                document.getElementById('resultTokenMint').textContent = confirmData.token_mint;
                document.getElementById('resultTwitter').textContent = '@' + twitterUsername;
                document.getElementById('viewOnPumpBtn').href = `https://pump.fun/coin/${confirmData.token_mint}`;

                goToStep(3);
                loadLaunchHistory();
                loadStats();

            } catch (err) {
                console.error('Launch error:', err);
                alert('Launch failed: ' + err.message);
                btnText.textContent = `launch agent + token (${CONFIG.LAUNCH_FEE} sol)`;
                btn.disabled = false;
            }
        });

        // Load launch history
        async function loadLaunchHistory() {
            try {
                const resp = await fetch(`${CONFIG.API_URL}/api/launchpad/launches`);
                if (resp.ok) {
                    const data = await resp.json();
                    const container = document.getElementById('launchHistory');
                    const noLaunches = document.getElementById('noLaunches');

                    const completedLaunches = data.launches.filter(l => l.status === 'completed');

                    if (completedLaunches.length > 0) {
                        noLaunches.style.display = 'none';

                        container.querySelectorAll('.launched-card').forEach(el => el.remove());

                        completedLaunches.forEach(launch => {
                            const card = document.createElement('div');
                            card.className = 'launched-card';
                            card.innerHTML = `
                                <div class="token-info">
                                    <h4>${launch.token_name}</h4>
                                    <div class="ticker">$${launch.token_ticker} ${launch.twitter_username ? '| @' + launch.twitter_username : ''}</div>
                                </div>
                                <a href="https://pump.fun/coin/${launch.token_mint}" target="_blank" class="view-btn">
                                    view
                                </a>
                            `;
                            container.appendChild(card);
                        });
                    }
                }
            } catch (err) {
                console.log('Could not load launch history:', err);
            }
        }

        // Load stats
        async function loadStats() {
            try {
                const resp = await fetch(`${CONFIG.API_URL}/api/launchpad/stats`);
                if (resp.ok) {
                    const data = await resp.json();
                    document.getElementById('totalAgents').textContent = data.total_launches || 0;
                }
            } catch (err) {
                console.log('Could not load stats');
            }
        }

        // Dev buy input handler
        document.getElementById('devBuy').addEventListener('input', (e) => {
            const devBuy = parseFloat(e.target.value) || 0;
            const total = devBuy + 0.05;
            const totalCostDiv = document.getElementById('totalCost');
            const totalCostValue = document.getElementById('totalCostValue');
            const launchBtnText = document.getElementById('launchBtnText');

            if (devBuy > 0) {
                totalCostDiv.style.display = 'block';
                totalCostValue.textContent = `${total.toFixed(2)} SOL`;
                launchBtnText.textContent = `launch agent + token (${total.toFixed(2)} sol)`;
            } else {
                totalCostDiv.style.display = 'none';
                launchBtnText.textContent = 'launch agent + token (0.05 sol)';
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await loadConfig();
            initWallet();
            setupStepIndicators();
            loadLaunchHistory();
            loadStats();
        });
    </script>
</body>
</html>
